const t=new class{constructor(t=Array.from({length:4},()=>[,,,,].fill(0))){this.initialState=t,this.state=t.map(t=>[...t]),this.status="idle",this.score=0}moveLeft(){if(!this.isStateValid(this.state))return;let t=this.state.map(t=>this.moveCells(t));this.updateGameState(t),this.completeMoveTasks()}moveRight(){let t=this.state.map(t=>[...t].reverse());if(!this.isStateValid(t))return;let e=t.map(t=>this.moveCells(t).reverse());this.updateGameState(e),this.completeMoveTasks()}moveUp(){let t=this.rotateRight(this.state);if(!this.isStateValid(t))return;let e=[...t.map(t=>this.moveCells([...t]))],s=this.rotateLeft(e);this.updateGameState(s),this.completeMoveTasks()}moveDown(){let t=[...this.rotateRight(this.state).map(t=>[...t].reverse())];if(!this.isStateValid(t))return;let e=t.map(t=>this.moveCells([...t]).reverse()),s=this.rotateLeft(e);this.updateGameState(s),this.completeMoveTasks()}moveCells(t){let e=[],s=0;for(;s<t.length;){let r=t[s],a=t[s+1];r?r===a?(e.push(2*r),this.score+=2*r,s+=2):(e.push(r),s++):s++}for(;e.length<t.length;)e.push(0);return e}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.status="playing",this.completeMoveTasks(2)}restart(){this.resetState(),this.status="idle",this.score=0}generateNewTile(){let t=this.getEmptyCells();if(!t.length)return;let[e,s]=t[Math.floor(Math.random()*t.length)];this.state[e][s]=.9>Math.random()?2:4}getEmptyCells(){return this.getState().flatMap((t,e)=>t.map((t,s)=>0===t?[e,s]:null)).filter(t=>null!==t)}rotateLeft(t){let e=[],s=t[0].length,r=t.length;for(let t=0;t<s;t++)e.push(Array.from({length:r},()=>""));for(let a=0;a<r;a++)for(let r=0;r<s;r++){let l=s-1-r;e[a][l]=t[r][a]}return e}rotateRight(t){let e=[],s=t[0].length,r=t.length;for(let t=0;t<s;t++)e.push(Array.from({length:r},()=>""));for(let a=0;a<r;a++)for(let r=0;r<s;r++){let l=a;e[s-1-r][l]=t[a][r]}return e}isStateValid(t){if("playing"!==this.status)return!1;for(let e of t){let t=!1,s=!1;for(let r=0;r<e.length-1;r++){if(e[r]===e[r+1]){t=!0;break}e[r]||(s=!0)}if(t||s)return!0}return!1}completeMoveTasks(t=1){for(let e=0;e<t;e++)this.generateNewTile();let e=this.getState();this.isVictory(e)?this.status="win":this.isDefeat(e)&&(this.status="lose")}isDefeat(t){let e=this.rotateRight(t);return[t,e].every(t=>!this.isStateValid(t))}isVictory(t){return t.flat().some(t=>2048===t)}resetState(){this.state=[...this.initialState.map(t=>[...t])]}updateGameState(t){this.state=t}},e=document.querySelector(".container"),s=document.querySelector(".game-field"),r=e.querySelector(".button"),a=e.querySelector(".game-score"),l={start:e.querySelector(".message-start"),restart:e.querySelector(".message-restart"),lose:e.querySelector(".message-lose"),win:e.querySelector(".message-win")},i=[...s.querySelectorAll(".field-row")].map(t=>[...t.children]);function o(t,e){t.forEach((t,s)=>{t.forEach((t,r)=>{let a=e[s][r];a.className=t?`field-cell field-cell--${t}`:"field-cell",a.innerHTML=t||""})})}function h(){let e=t.getStatus();for(let t in l)if(Object.hasOwnProperty.call(l,t)){let s=l[t];s&&s.classList.toggle("hidden",t!==e)}}r.addEventListener("click",()=>{if("Start"===r.textContent)t.start(),r.textContent="Restart",r.classList.replace("start","restart");else{var e;t.restart(),e=t.getScore(),a.innerHTML=e,r.textContent="Start",r.classList.replace("restart","start")}o(t.getState(),i),h()}),document.addEventListener("keydown",e=>{if(e.preventDefault(),"playing"!==t.getStatus())return;let s={ArrowUp:t.moveUp,ArrowDown:t.moveDown,ArrowLeft:t.moveLeft,ArrowRight:t.moveRight}[e.key];s&&s.call(t);let r=t.getScore();o(t.getState(),i),a.innerHTML=r,h()});
//# sourceMappingURL=index.e1072092.js.map
